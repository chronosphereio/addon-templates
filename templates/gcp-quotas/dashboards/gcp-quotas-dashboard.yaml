api_version: v1/config
kind: Dashboard
spec:
  slug: gcp-quotas
  name: GCP Quotas
  collection_slug: gcp-collection
  dashboard_json: '{"kind":"Dashboard","spec":{"datasource":null,"duration":"30m","layouts":[{"kind":"Grid","spec":{"display":{"title":"Current
    Utilization","collapse":{"open":true}},"items":[{"x":0,"y":0,"width":8,"height":9,"content":{"$ref":"#/spec/panels/allocationQuotaUtilizationTopTopk-2"}},{"x":8,"y":0,"width":8,"height":9,"content":{"$ref":"#/spec/panels/perMinuteRateQuotaUtilization30MAvgTopTopk-11"}},{"x":16,"y":0,"width":8,"height":9,"content":{"$ref":"#/spec/panels/perDayRateQuotaUtilizationTrailing24HTopTopk-12"}}]}},{"kind":"Grid","spec":{"display":{"title":"Utilization
    Over Time","collapse":{"open":true}},"items":[{"x":0,"y":0,"width":8,"height":10,"content":{"$ref":"#/spec/panels/allocationQuotaUtilizationTopTopk-6"}},{"x":8,"y":0,"width":8,"height":10,"content":{"$ref":"#/spec/panels/perMinuteRateQuotaUtilization30MAvgTopTopk-4"}},{"x":16,"y":0,"width":8,"height":10,"content":{"$ref":"#/spec/panels/perDayRateQuotaUtilizationTrailing24HTopTopk-5"}},{"x":8,"y":10,"width":8,"height":10,"content":{"$ref":"#/spec/panels/perMinuteRateQuotaUtilizationRawTopTopk-22"}}]}},{"kind":"Grid","spec":{"display":{"title":"Raw
    Usage and Limit Values","collapse":{"open":false}},"items":[{"x":0,"y":0,"width":8,"height":10,"content":{"$ref":"#/spec/panels/allocationQuotaUsage-16"}},{"x":8,"y":0,"width":8,"height":10,"content":{"$ref":"#/spec/panels/perMinuteRateQuotaUsage30MAvg-18"}},{"x":16,"y":0,"width":8,"height":10,"content":{"$ref":"#/spec/panels/perDayRateQuotaUsageTrailing24H-19"}},{"x":0,"y":10,"width":8,"height":10,"content":{"$ref":"#/spec/panels/allocationQuotaLimits-17"}},{"x":8,"y":10,"width":8,"height":10,"content":{"$ref":"#/spec/panels/perMinuteRateQuotaLimits-20"}},{"x":16,"y":10,"width":8,"height":10,"content":{"$ref":"#/spec/panels/perDayRateQuotaLimits-21"}}]}}],"panels":{"allocationQuotaLimits-17":{"kind":"Panel","spec":{"display":{"description":"","name":"Allocation
    Quota Limits"},"plugin":{"kind":"BarChart","spec":{"calculation":"LastNumber","unit":{"abbreviate":true,"kind":"Decimal"}}},"queries":[{"kind":"DataQuery","spec":{"plugin":{"kind":"PrometheusTimeSeriesQuery","spec":{"query":"label_replace(\nlabel_replace(\n
    max by (project_id,location,service,quota_metric,limit_name) (\n last_over_time(\nstackdriver_consumer_quota_serviceruntime_googleapis_com_quota_limit{project_id=~\"$project\",location=~\"$location\",service=~\"$service\",quota_metric=~\"$metric\",limit_name!~\".*(PerMin|PerDay).*\"}[36h]\n
    )\n > 0\n < 2^62\n )\n,\n\"quota_metric\", \"$1/$2\", \"quota_metric\", \"([^\\\\.]+)\\\\.googleapis\\\\.com/(.+)\"),\n\"project_id\",
    \"$1\", \"project_id\", \"(.+)\")\n","series_name_format":"{{quota_metric}} ({{project_id}}/{{location}})"}}}}]}},"allocationQuotaUsage-16":{"kind":"Panel","spec":{"display":{"description":"","name":"Allocation
    Quota Usage"},"plugin":{"kind":"BarChart","spec":{"calculation":"LastNumber","unit":{"abbreviate":true,"kind":"Decimal"}}},"queries":[{"kind":"DataQuery","spec":{"plugin":{"kind":"PrometheusTimeSeriesQuery","spec":{"query":"label_replace(\nlabel_replace(\n
    last_over_time(\n max by (project_id,location,service,quota_metric) (\n stackdriver_consumer_quota_serviceruntime_googleapis_com_quota_allocation_usage{project_id=~\"$project\",location=~\"$location\",service=~\"$service\",quota_metric=~\"$metric\"}\n
    )[36h:]\n ) > 0\n,\n\"quota_metric\", \"$1/$2\", \"quota_metric\", \"([^\\\\.]+)\\\\.googleapis\\\\.com/(.+)\"),\n\"project_id\",
    \"$1\", \"project_id\", \"(.+)\")\n","series_name_format":"{{quota_metric}} ({{project_id}}/{{location}})"}}}}]}},"allocationQuotaUtilizationTopTopk-2":{"kind":"Panel","spec":{"display":{"description":"","name":"Allocation
    Quota Utilization (top $topk)"},"plugin":{"kind":"BarChart","spec":{"calculation":"LastNumber","unit":{"abbreviate":true,"decimal_places":1,"kind":"PercentDecimal"}}},"queries":[{"kind":"DataQuery","spec":{"plugin":{"kind":"PrometheusTimeSeriesQuery","spec":{"query":"label_replace(\nlabel_replace(\ntopk
    (\n $topk,\n (\n last_over_time(\n max by (project_id,location,service,quota_metric)
    (\n stackdriver_consumer_quota_serviceruntime_googleapis_com_quota_allocation_usage{project_id=~\"$project\",location=~\"$location\",service=~\"$service\",quota_metric=~\"$metric\"}\n
    )[36h:]\n ) > 0\n )\n / ignoring(limit_name) group_right()\n (\n max by (project_id,location,service,quota_metric,limit_name)
    (\n last_over_time(\nstackdriver_consumer_quota_serviceruntime_googleapis_com_quota_limit{project_id=~\"$project\",location=~\"$location\",service=~\"$service\",quota_metric=~\"$metric\",limit_name!~\".*(PerMin|PerDay).*\"}[36h]\n
    )\n )\n )\n),\n\"quota_metric\", \"$1/$2\", \"quota_metric\", \"([^\\\\.]+)\\\\.googleapis\\\\.com/(.+)\"),\n\"project_id\",
    \"$1\", \"project_id\", \"(.+)\")\n","series_name_format":"{{quota_metric}} ({{project_id}}/{{location}})"}}}}]}},"allocationQuotaUtilizationTopTopk-6":{"kind":"Panel","spec":{"display":{"description":"","name":"Allocation
    Quota Utilization (top $topk)"},"plugin":{"kind":"TimeSeriesChart","spec":{"tooltip":{"mode":"nearby"},"visual":{},"y_axis":{"max":1.2,"min":0,"unit":{"abbreviate":true,"decimal_places":0,"kind":"PercentDecimal"}}}},"queries":[{"kind":"DataQuery","spec":{"plugin":{"kind":"PrometheusTimeSeriesQuery","spec":{"query":"label_replace(\nlabel_replace(\ntopk
    (\n $topk,\n (\n last_over_time(\n max by (project_id,location,service,quota_metric)
    (\n stackdriver_consumer_quota_serviceruntime_googleapis_com_quota_allocation_usage{project_id=~\"$project\",location=~\"$location\",service=~\"$service\",quota_metric=~\"$metric\"}\n
    )[36h:]\n ) > 0\n )\n / ignoring(limit_name) group_right()\n (\n max by (project_id,location,service,quota_metric,limit_name)
    (\n last_over_time(\nstackdriver_consumer_quota_serviceruntime_googleapis_com_quota_limit{project_id=~\"$project\",location=~\"$location\",service=~\"$service\",quota_metric=~\"$metric\",limit_name!~\".*(PerMin|PerDay).*\"}[36h]\n
    )\n )\n )\n),\n\"quota_metric\", \"$1/$2\", \"quota_metric\", \"([^\\\\.]+)\\\\.googleapis\\\\.com/(.+)\"),\n\"project_id\",
    \"$1\", \"project_id\", \"(.+)\")\n","series_name_format":"{{quota_metric}} ({{project_id}}/{{location}})"}}}}]}},"perDayRateQuotaLimits-21":{"kind":"Panel","spec":{"display":{"description":"","name":"Per-Day
    Rate Quota Limits"},"plugin":{"kind":"BarChart","spec":{"calculation":"LastNumber","unit":{"abbreviate":true,"kind":"Decimal"}}},"queries":[{"kind":"DataQuery","spec":{"plugin":{"kind":"PrometheusTimeSeriesQuery","spec":{"query":"label_replace(\nlabel_replace(\nmax
    by (project_id,location,service,quota_metric,limit_name) (\nlast_over_time(stackdriver_consumer_quota_serviceruntime_googleapis_com_quota_limit{project_id=~\"$project\",location=~\"$location\",service=~\"$service\",quota_metric=~\"$metric\",limit_name=~\".*PerDay.*\"}[36h])\n>
    0\n< 2^62\n)\n \n,\n\"quota_metric\", \"$1/$2\", \"quota_metric\", \"([^\\\\.]+)\\\\.googleapis\\\\.com/(.+)\"),\n\"project_id\",
    \"$1\", \"project_id\", \"(.+)\")\n","series_name_format":"{{quota_metric}} ({{project_id}}/{{location}})"}}}}]}},"perDayRateQuotaUsageTrailing24H-19":{"kind":"Panel","spec":{"display":{"description":"","name":"Per-Day
    Rate Quota Usage (trailing 24h)"},"plugin":{"kind":"BarChart","spec":{"calculation":"LastNumber","unit":{"abbreviate":true,"kind":"Decimal"}}},"queries":[{"kind":"DataQuery","spec":{"plugin":{"kind":"PrometheusTimeSeriesQuery","spec":{"query":"label_replace(\nlabel_replace(\n\n
    sum by (project_id,location,service,quota_metric) (sum_over_time(stackdriver_consumer_quota_serviceruntime_googleapis_com_quota_rate_net_usage{project_id=~\"$project\",location=~\"$location\",service=~\"$service\",quota_metric=~\"$metric\"}[1d])
    > 0)\n / ignoring(limit_name) group_right()\n \n group by (project_id,location,service,quota_metric,limit_name)
    (last_over_time(stackdriver_consumer_quota_serviceruntime_googleapis_com_quota_limit{project_id=~\"$project\",location=~\"$location\",service=~\"$service\",quota_metric=~\"$metric\",limit_name=~\".*PerDay.*\"}[36h]))\n
    \n \n,\n\"quota_metric\", \"$1/$2\", \"quota_metric\", \"([^\\\\.]+)\\\\.googleapis\\\\.com/(.+)\"),\n\"project_id\",
    \"$1\", \"project_id\", \"(.+)\")","series_name_format":"{{quota_metric}} ({{project_id}}/{{location}})"}}}}]}},"perDayRateQuotaUtilizationTrailing24HTopTopk-12":{"kind":"Panel","spec":{"display":{"description":"","name":"Per-Day
    Rate Quota Utilization (trailing 24h) (top $topk)"},"plugin":{"kind":"BarChart","spec":{"calculation":"LastNumber","unit":{"abbreviate":true,"decimal_places":1,"kind":"PercentDecimal"}}},"queries":[{"kind":"DataQuery","spec":{"plugin":{"kind":"PrometheusTimeSeriesQuery","spec":{"query":"label_replace(\nlabel_replace(\ntopk
    ($topk,\n sum by (project_id,location,service,quota_metric) (sum_over_time(stackdriver_consumer_quota_serviceruntime_googleapis_com_quota_rate_net_usage{project_id=~\"$project\",location=~\"$location\",service=~\"$service\",quota_metric=~\"$metric\"}[1d])
    > 0)\n / ignoring(limit_name) group_right\n max by (project_id,location,service,quota_metric,limit_name)
    (last_over_time(stackdriver_consumer_quota_serviceruntime_googleapis_com_quota_limit{project_id=~\"$project\",location=~\"$location\",service=~\"$service\",quota_metric=~\"$metric\",limit_name=~\".*PerDay.*\"}[36h]))\n),\n\"quota_metric\",
    \"$1/$2\", \"quota_metric\", \"([^\\\\.]+)\\\\.googleapis\\\\.com/(.+)\"),\n\"project_id\",
    \"$1\", \"project_id\", \"(.+)\")","series_name_format":"{{quota_metric}} ({{project_id}}/{{location}})"}}}}]}},"perDayRateQuotaUtilizationTrailing24HTopTopk-5":{"kind":"Panel","spec":{"display":{"description":"","name":"Per-Day
    Rate Quota Utilization (trailing 24h) (top $topk)"},"plugin":{"kind":"TimeSeriesChart","spec":{"tooltip":{"mode":"nearby"},"visual":{},"y_axis":{"max":1.2,"min":0,"unit":{"abbreviate":true,"decimal_places":0,"kind":"PercentDecimal"}}}},"queries":[{"kind":"DataQuery","spec":{"plugin":{"kind":"PrometheusTimeSeriesQuery","spec":{"query":"label_replace(\nlabel_replace(\ntopk
    ($topk,\n sum by (project_id,location,service,quota_metric) (sum_over_time(stackdriver_consumer_quota_serviceruntime_googleapis_com_quota_rate_net_usage{project_id=~\"$project\",location=~\"$location\",service=~\"$service\",quota_metric=~\"$metric\"}[1d])
    > 0)\n / ignoring(limit_name) group_right\n max by (project_id,location,service,quota_metric,limit_name)
    (last_over_time(stackdriver_consumer_quota_serviceruntime_googleapis_com_quota_limit{project_id=~\"$project\",location=~\"$location\",service=~\"$service\",quota_metric=~\"$metric\",limit_name=~\".*PerDay.*\"}[36h]))\n),\n\"quota_metric\",
    \"$1/$2\", \"quota_metric\", \"([^\\\\.]+)\\\\.googleapis\\\\.com/(.+)\"),\n\"project_id\",
    \"$1\", \"project_id\", \"(.+)\")","series_name_format":"{{quota_metric}} ({{project_id}}/{{location}})"}}}}]}},"perMinuteRateQuotaLimits-20":{"kind":"Panel","spec":{"display":{"description":"","name":"Per-Minute
    Rate Quota Limits"},"plugin":{"kind":"BarChart","spec":{"calculation":"LastNumber","unit":{"abbreviate":true,"kind":"Decimal"}}},"queries":[{"kind":"DataQuery","spec":{"plugin":{"kind":"PrometheusTimeSeriesQuery","spec":{"query":"label_replace(\nlabel_replace(\nmax
    by (project_id,location,service,quota_metric,limit_name) (\nlast_over_time(stackdriver_consumer_quota_serviceruntime_googleapis_com_quota_limit{project_id=~\"$project\",location=~\"$location\",service=~\"$service\",quota_metric=~\"$metric\",limit_name=~\".*PerMin.*\"}[36h])\n>
    0\n < 2^62\n)\n \n,\n\"quota_metric\", \"$1/$2\", \"quota_metric\", \"([^\\\\.]+)\\\\.googleapis\\\\.com/(.+)\"),\n\"project_id\",
    \"$1\", \"project_id\", \"(.+)\")\n","series_name_format":"{{quota_metric}} ({{project_id}}/{{location}})"}}}}]}},"perMinuteRateQuotaUsage30MAvg-18":{"kind":"Panel","spec":{"display":{"description":"","name":"Per-Minute
    Rate Quota Usage (30m avg)"},"plugin":{"kind":"BarChart","spec":{"calculation":"LastNumber","unit":{"abbreviate":true,"kind":"Decimal"}}},"queries":[{"kind":"DataQuery","spec":{"plugin":{"kind":"PrometheusTimeSeriesQuery","spec":{"query":"label_replace(\nlabel_replace(\n\n
    sum by (project_id,location,service,quota_metric) (sum_over_time(stackdriver_consumer_quota_serviceruntime_googleapis_com_quota_rate_net_usage{project_id=~\"$project\",location=~\"$location\",service=~\"$service\",quota_metric=~\"$metric\"}[30m])/30
    > 0)\n / ignoring(limit_name) group_right\n group by (project_id,location,service,quota_metric,limit_name)
    (last_over_time(stackdriver_consumer_quota_serviceruntime_googleapis_com_quota_limit{project_id=~\"$project\",location=~\"$location\",service=~\"$service\",quota_metric=~\"$metric\",limit_name=~\".*PerMin.*\"}[36h]))
    \n \n,\n\"quota_metric\", \"$1/$2\", \"quota_metric\", \"([^\\\\.]+)\\\\.googleapis\\\\.com/(.+)\"),\n\"project_id\",
    \"$1\", \"project_id\", \"(.+)\")","series_name_format":"{{quota_metric}} ({{project_id}}/{{location}})"}}}}]}},"perMinuteRateQuotaUtilization30MAvgTopTopk-11":{"kind":"Panel","spec":{"display":{"description":"","name":"Per-Minute
    Rate Quota Utilization (30m avg) (top $topk)"},"links":[],"plugin":{"kind":"BarChart","spec":{"calculation":"LastNumber","unit":{"abbreviate":true,"decimal_places":1,"kind":"PercentDecimal"}}},"queries":[{"kind":"DataQuery","spec":{"plugin":{"kind":"PrometheusTimeSeriesQuery","spec":{"query":"label_replace(\nlabel_replace(\ntopk
    ($topk,\n sum by (project_id,location,service,quota_metric) (sum_over_time(stackdriver_consumer_quota_serviceruntime_googleapis_com_quota_rate_net_usage{project_id=~\"$project\",location=~\"$location\",service=~\"$service\",quota_metric=~\"$metric\"}[30m])/30
    > 0)\n / ignoring(limit_name) group_right\n max by (project_id,location,service,quota_metric,limit_name)
    (last_over_time(stackdriver_consumer_quota_serviceruntime_googleapis_com_quota_limit{project_id=~\"$project\",location=~\"$location\",service=~\"$service\",quota_metric=~\"$metric\",limit_name=~\".*PerMin.*\"}[36h]))\n),\n\"quota_metric\",
    \"$1/$2\", \"quota_metric\", \"([^\\\\.]+)\\\\.googleapis\\\\.com/(.+)\"),\n\"project_id\",
    \"$1\", \"project_id\", \"(.+)\")","series_name_format":"{{quota_metric}} ({{project_id}}/{{location}})"}}}}]}},"perMinuteRateQuotaUtilization30MAvgTopTopk-4":{"kind":"Panel","spec":{"display":{"description":"","name":"Per-Minute
    Rate Quota Utilization (30m avg) (top $topk)"},"plugin":{"kind":"TimeSeriesChart","spec":{"tooltip":{"mode":"nearby"},"visual":{},"y_axis":{"max":1.2,"min":0,"unit":{"abbreviate":true,"decimal_places":0,"kind":"PercentDecimal"}}}},"queries":[{"kind":"DataQuery","spec":{"plugin":{"kind":"PrometheusTimeSeriesQuery","spec":{"query":"label_replace(\nlabel_replace(\ntopk
    ($topk,\n sum by (project_id,location,service,quota_metric) (sum_over_time(stackdriver_consumer_quota_serviceruntime_googleapis_com_quota_rate_net_usage{project_id=~\"$project\",location=~\"$location\",service=~\"$service\",quota_metric=~\"$metric\"}[30m])/30
    > 0)\n / ignoring(limit_name) group_right\n max by (project_id,location,service,quota_metric,limit_name)
    (last_over_time(stackdriver_consumer_quota_serviceruntime_googleapis_com_quota_limit{project_id=~\"$project\",location=~\"$location\",service=~\"$service\",quota_metric=~\"$metric\",limit_name=~\".*PerMin.*\"}[36h]))\n),\n\"quota_metric\",
    \"$1/$2\", \"quota_metric\", \"([^\\\\.]+)\\\\.googleapis\\\\.com/(.+)\"),\n\"project_id\",
    \"$1\", \"project_id\", \"(.+)\")","series_name_format":"{{quota_metric}} ({{project_id}}/{{location}})"}}}}]}},"perMinuteRateQuotaUtilizationRawTopTopk-22":{"kind":"Panel","spec":{"display":{"description":"","name":"Per-Minute
    Rate Quota Utilization (raw) (top $topk)"},"plugin":{"kind":"TimeSeriesChart","spec":{"tooltip":{"mode":"nearby"},"visual":{},"y_axis":{"max":1.2,"min":0,"unit":{"abbreviate":true,"decimal_places":0,"kind":"PercentDecimal"}}}},"queries":[{"kind":"DataQuery","spec":{"plugin":{"kind":"PrometheusTimeSeriesQuery","spec":{"query":"label_replace(\nlabel_replace(\ntopk
    ($topk,\n sum by (project_id,location,service,quota_metric) (stackdriver_consumer_quota_serviceruntime_googleapis_com_quota_rate_net_usage{project_id=~\"$project\",location=~\"$location\",service=~\"$service\",quota_metric=~\"$metric\"}
    > 0)\n / ignoring(limit_name) group_right\n max by (project_id,location,service,quota_metric,limit_name)
    (last_over_time(stackdriver_consumer_quota_serviceruntime_googleapis_com_quota_limit{project_id=~\"$project\",location=~\"$location\",service=~\"$service\",quota_metric=~\"$metric\",limit_name=~\".*PerMin.*\"}[36h]))\n),\n\"quota_metric\",
    \"$1/$2\", \"quota_metric\", \"([^\\\\.]+)\\\\.googleapis\\\\.com/(.+)\"),\n\"project_id\",
    \"$1\", \"project_id\", \"(.+)\")","series_name_format":"{{quota_metric}} ({{project_id}}/{{location}})"}}}}]}}},"variables":[{"kind":"ListVariable","spec":{"allow_all_value":true,"allow_multiple":true,"default_value":[],"name":"project","plugin":{"kind":"PrometheusLabelValuesVariable","spec":{"label_name":"project_id","matchers":["stackdriver_consumer_quota_serviceruntime_googleapis_com_quota_limit"]}},"refresh":"TimeRangeUpdate"}},{"kind":"ListVariable","spec":{"allow_all_value":true,"allow_multiple":true,"default_value":"$__all","name":"location","plugin":{"kind":"PrometheusLabelValuesVariable","spec":{"label_name":"location","matchers":["stackdriver_consumer_quota_serviceruntime_googleapis_com_quota_limit{project_id=~\"$project\"}"]}}}},{"kind":"ListVariable","spec":{"allow_all_value":true,"allow_multiple":true,"default_value":"$__all","name":"service","plugin":{"kind":"PrometheusLabelValuesVariable","spec":{"label_name":"service","matchers":["stackdriver_consumer_quota_serviceruntime_googleapis_com_quota_limit{project_id=~\"$project\",location=~\"$location\"}"]}}}},{"kind":"ListVariable","spec":{"allow_all_value":true,"allow_multiple":true,"default_value":"$__all","name":"metric","plugin":{"kind":"PrometheusLabelValuesVariable","spec":{"label_name":"quota_metric","matchers":["stackdriver_consumer_quota_serviceruntime_googleapis_com_quota_limit{project_id=~\"$project\",location=~\"$location\",service=~\"$service\"}"]}}}},{"kind":"ListVariable","spec":{"allow_all_value":false,"allow_multiple":false,"default_value":"10","name":"topk","plugin":{"kind":"StaticListVariable","spec":{"values":["1","5","10","20","50","100"]}}}}],"events":[]},"spec_version":"1"}'