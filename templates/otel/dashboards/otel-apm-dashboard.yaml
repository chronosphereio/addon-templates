api_version: v1/config
kind: Dashboard
spec:
  slug: otel-apm
  name: OTEL APM
  collection_slug: otel-collection
  dashboard_json: '{"kind":"Dashboard","spec":{"events":[],"panels":{"95ResponseTimeByEndpoint-7":{"kind":"Panel","spec":{"display":{"description":"","name":"95%
    response time by endpoint"},"formulas":[],"links":[],"plugin":{"kind":"TimeSeriesChart","spec":{"legend":{"mode":"Table","position":"Bottom","values":["Mean","Max"]},"tooltip":{"mode":"nearby"},"visual":{"area_opacity":0.05,"line_width":1.5,"point_radius":3},"y_axis":{"unit":{"kind":"Milliseconds"}}}},"queries":[{"kind":"DataQuery","spec":{"plugin":{"kind":"PrometheusTimeSeriesQuery","spec":{"query":"histogram_quantile(0.95,
    sum(rate(http_server_duration_milliseconds_bucket{job=~\"$job\", app_env=~\"$app_env\",http_route=~\"$http_route\"}[2m]))
    by (le,http_route))","series_name":{"name_pattern":"{{http_route}}","type":"Labels"}}}}}]}},"apdexByPerService-21":{"kind":"Panel","spec":{"display":{"description":"Apdex
    is ratio of \"satisfied and tolerating\" experiences . 1 is Optimal, the lower
    the score, the less optimal experience (higher frustrating or tolerating experiences).
    ","name":"APDEX by Per Service"},"formulas":[],"links":[],"plugin":{"kind":"TimeSeriesChart","spec":{"legend":{"mode":"Table","position":"Right","values":["Mean","Last"]},"tooltip":{"mode":"nearby"},"visual":{"area_opacity":0.05,"line_width":1.5,"point_radius":3},"y_axis":{"show":true,"unit":{"abbreviate":true,"kind":"Decimal"}}}},"queries":[{"kind":"DataQuery","spec":{"plugin":{"kind":"PrometheusTimeSeriesQuery","spec":{"query":"(\n  sum(\n    rate(\n      http_server_duration_milliseconds_bucket{le
    =~ \"$satisfactory_threshold\", \n       job =~ \"$job\", app_env =~ \"$app_env\"}[10m]\n    )\n  )
    by (app_env) + 0.5 * (\n    sum(\n      rate(\n        http_server_duration_milliseconds_bucket{le
    =~ \"$tolerable_threshold\", \n         job =~ \"$job\", app_env =~ \"$app_env\"}[10m]\n      )\n    )
    by (app_env) - sum(\n      rate(\n        http_server_duration_milliseconds_bucket{le
    =~ \"$satisfactory_threshold\", \n         job =~ \"$job\", app_env =~ \"$app_env\"}[10m]\n      )\n    )
    by (app_env)\n  )\n) / sum(\n  rate(\n    http_server_duration_milliseconds_count{
    job =~ \"$job\", app_env =~ \"$app_env\"}[10m]\n  )\n) by (app_env)","series_name_format":"{{app_env}}"}}}}]}},"averageResponseTime-8":{"kind":"Panel","spec":{"display":{"description":"","name":"Average
    Response Time"},"formulas":[],"links":[],"plugin":{"kind":"TimeSeriesChart","spec":{"legend":{"mode":"Table","position":"Bottom","values":["Mean","Last"]},"tooltip":{"mode":"nearby"},"visual":{"area_opacity":0.05,"line_width":1.5,"point_radius":3},"y_axis":{"min":0,"unit":{"abbreviate":true,"kind":"Milliseconds"}}}},"queries":[{"kind":"DataQuery","spec":{"plugin":{"kind":"PrometheusTimeSeriesQuery","spec":{"query":"sum(rate(http_server_duration_milliseconds_sum{job=~\"$job\",
    app_env=~\"$app_env\",http_method=~\"$http_method\",http_status_code=~\"$http_status_code\",http_route=~\"$http_route\"}[2m]))\n/\nsum(rate(http_server_duration_milliseconds_count{job=~\"$job\",
    app_env=~\"$app_env\",http_method=~\"$http_method\",http_status_code=~\"$http_status_code\",http_route=~\"$http_route\"}[2m]))","series_name_format":"Total"}}}}]}},"errorRatePerMinute-15":{"kind":"Panel","spec":{"display":{"description":"","name":"Error
    Rate per minute"},"formulas":[],"links":[],"plugin":{"kind":"TimeSeriesChart","spec":{"legend":{"mode":"Table","position":"Bottom","values":["Mean","Last"]},"tooltip":{"mode":"nearby"},"visual":{"area_opacity":0.05,"line_width":1.5,"point_radius":3},"y_axis":{"unit":{"abbreviate":true,"kind":"Percent"}}}},"queries":[{"kind":"DataQuery","spec":{"plugin":{"kind":"PrometheusTimeSeriesQuery","spec":{"query":"(sum(rate(http_server_duration_milliseconds_count{
    job=~ \"$job\", app_env=~ \"$app_env\",status=~\"^[45].*\"}[10m])*60) by (job,status)/sum(rate(http_server_duration_milliseconds_count{
    job=~ \"$job\", app_env=~ \"$app_env\"}[10m])*60) by (job,status))*100","series_name_format":"{{http_status}}"}}}}]}},"maxResponseTime-13":{"kind":"Panel","spec":{"display":{"description":"","name":"Max
    response time"},"formulas":[],"links":[],"plugin":{"kind":"TimeSeriesChart","spec":{"legend":{"mode":"Table","position":"Bottom","values":["Max","Last"]},"tooltip":{"mode":"nearby"},"visual":{"area_opacity":0.05,"line_width":1.5,"point_radius":3},"y_axis":{"min":0,"unit":{"abbreviate":true,"kind":"Milliseconds"}}}},"queries":[{"kind":"DataQuery","spec":{"plugin":{"kind":"PrometheusTimeSeriesQuery","spec":{"query":"histogram_quantile(1,
    sum(rate(http_server_duration_milliseconds_bucket{job=~\"$job\", app_env=~\"$app_env\",http_route=~\"$http_route\"}[2m]))
    by (le,http_route))","series_name":{"name_pattern":"{{http_route}}","type":"Labels"}}}}}]}},"mostFrequentControllersDay-17":{"kind":"Panel","spec":{"display":{"description":"Average
    number of requests per day during last week","name":"Most Frequent HTTP Routes"},"formulas":[],"links":[],"plugin":{"kind":"BarChart","spec":{"calculation":"LastNumber","mode":"value","sort":"desc","unit":{"abbreviate":true,"kind":"Decimal"}}},"queries":[{"kind":"DataQuery","spec":{"plugin":{"kind":"PrometheusTimeSeriesQuery","spec":{"query":"topk(50,sum(rate(http_server_duration_milliseconds_count{app_env=~\"$app_env\",job=~\"$job\"}[1d])
    * 3600 * 24) by (http_route))","series_name":{"name_pattern":"{{http_route}}","type":"Labels"}}}}}]}},"slowActions-23":{"kind":"Panel","spec":{"display":{"description":"","name":"Slow
    Actions"},"formulas":[],"links":[],"plugin":{"kind":"BarChart","spec":{"calculation":"LastNumber","mode":"value","sort":"desc","unit":{"abbreviate":true,"kind":"Decimal"}}},"queries":[{"kind":"DataQuery","spec":{"plugin":{"kind":"PrometheusTimeSeriesQuery","spec":{"query":"topk(10,avg(rate(http_server_duration_milliseconds_sum{app_env=~\"$app_env\",job=~\"$job\"}[1d])
    / rate(http_server_duration_milliseconds_count{app_env=~\"$app_env\",job=~\"$job\"}[1d]))
    by (http_route))","series_name":{"name_pattern":"{{http_route}}","type":"Labels"}}}}}]}},"throughputEndpoint-6":{"kind":"Panel","spec":{"display":{"description":"","name":"Throughput
    / Endpoint"},"formulas":[],"links":[],"plugin":{"kind":"TimeSeriesChart","spec":{"legend":{"mode":"Table","position":"Bottom","values":["Max","Mean","Sum"]},"tooltip":{"mode":"nearby"},"visual":{"area_opacity":0.05,"line_width":1.5,"point_radius":3},"y_axis":{"min":0,"unit":{"abbreviate":true,"kind":"Decimal"}}}},"queries":[{"kind":"DataQuery","spec":{"plugin":{"kind":"PrometheusTimeSeriesQuery","spec":{"query":"sum
    by (http_route)(rate(http_server_duration_milliseconds_count{ app_env=~\"$app_env\",job=~\"$job\",http_route=~\"$http_route\",http_method=~\"$http_method\",http_status_code=~\"$http_status_code\"}[2m]))*60","series_name":{"name_pattern":"{{http_route}}","type":"Labels"}}}}}]}},"throughputRequestsPerMinute-12":{"kind":"Panel","spec":{"display":{"description":"","name":"Throughput
    - Requests per Minute"},"formulas":[],"links":[],"plugin":{"kind":"TimeSeriesChart","spec":{"legend":{"mode":"Table","position":"Bottom","values":["Mean","Last"]},"overrides":[{"matcher":{"type":"ByName"},"properties":{"color":"#E67700"},"value":"200"}],"tooltip":{"mode":"nearby"},"visual":{"area_opacity":0.05,"line_width":1.5,"null_behavior":"Connected","point_radius":3,"stack":"All"},"y_axis":{"min":0,"unit":{"abbreviate":true,"kind":"Decimal"}}}},"queries":[{"kind":"DataQuery","spec":{"plugin":{"kind":"PrometheusTimeSeriesQuery","spec":{"query":"sum
    by (status)(rate(http_server_duration_milliseconds_count{job=~\"$job\", app_env=~\"$app_env\",http_method=~\"$http_method\",http_status_code=~\"$http_status_code\",http_route=~\"$http_route\"}[2m]))*60","series_name_format":"{{http_status}}"}}}}]}}},"layouts":[{"kind":"Grid","spec":{"items":[{"x":0,"y":0,"width":12,"height":8,"content":{"$ref":"#/spec/panels/apdexByPerService-21"}},{"x":12,"y":0,"width":12,"height":8,"content":{"$ref":"#/spec/panels/averageResponseTime-8"}},{"x":0,"y":8,"width":12,"height":8,"content":{"$ref":"#/spec/panels/throughputRequestsPerMinute-12"}},{"x":12,"y":16,"width":12,"height":8,"content":{"$ref":"#/spec/panels/maxResponseTime-13"}},{"x":0,"y":16,"width":12,"height":8,"content":{"$ref":"#/spec/panels/95ResponseTimeByEndpoint-7"}},{"x":12,"y":8,"width":12,"height":8,"content":{"$ref":"#/spec/panels/errorRatePerMinute-15"}},{"x":0,"y":24,"width":12,"height":8,"content":{"$ref":"#/spec/panels/throughputEndpoint-6"}},{"x":12,"y":24,"width":12,"height":8,"content":{"$ref":"#/spec/panels/mostFrequentControllersDay-17"}},{"x":0,"y":32,"width":12,"height":8,"content":{"$ref":"#/spec/panels/slowActions-23"}}]}}],"variables":[{"kind":"ListVariable","spec":{"allow_all_value":false,"allow_multiple":false,"default_value":"y4c-onboarding-auth-prod","display":{"name":"Service"},"name":"job","plugin":{"kind":"PrometheusLabelValuesVariable","spec":{"label_name":"job","matchers":["http_server_duration_milliseconds_count{job!~\".*worker.*\"}"]}},"refresh":"DashboardLoad"}},{"kind":"ListVariable","spec":{"allow_all_value":false,"allow_multiple":false,"default_value":"prod","display":{"name":"app_env"},"name":"app_env","plugin":{"kind":"PrometheusLabelValuesVariable","spec":{"label_name":"app_env","matchers":["http_server_duration_milliseconds_count{job=~\"$job\"}"]}},"refresh":"DashboardLoad"}},{"kind":"ListVariable","spec":{"allow_all_value":true,"allow_multiple":true,"default_value":"$__all","display":{"name":"http_route"},"name":"http_route","plugin":{"kind":"PrometheusLabelValuesVariable","spec":{"label_name":"http_route","matchers":["http_server_duration_milliseconds_sum{app_env=~\"$app_env\",
    job=~\"$job\"}"]}},"refresh":"DashboardLoad"}},{"kind":"ListVariable","spec":{"allow_all_value":true,"allow_multiple":true,"default_value":"$__all","display":{"name":"Method"},"name":"http_method","plugin":{"kind":"PrometheusLabelValuesVariable","spec":{"label_name":"http_method","matchers":["http_server_duration_milliseconds_sum{app_env=~\"$app_env\",
    job=~\"$job\"}"]}},"refresh":"DashboardLoad"}},{"kind":"ListVariable","spec":{"allow_all_value":true,"allow_multiple":true,"default_value":"$__all","display":{"name":"http_status_code"},"name":"http_status_code","plugin":{"kind":"PrometheusLabelValuesVariable","spec":{"label_name":"http_status_code","matchers":["http_server_duration_milliseconds_sum{app_env=~\"$app_env\",
    job=~\"$job\"}"]}},"refresh":"DashboardLoad"}},{"kind":"ListVariable","spec":{"allow_all_value":false,"allow_multiple":false,"default_value":"2500.0","display":{"name":"Apdex
    Satisfactory Threshold"},"name":"satisfactory_threshold","plugin":{"kind":"PrometheusLabelValuesVariable","spec":{"label_name":"le","matchers":["http_server_duration_milliseconds_bucket{app_env=~\"$app_env\",
    job=~\"$job\",  le !=\"+Inf\"}"]}},"refresh":"DashboardLoad"}},{"kind":"ListVariable","spec":{"allow_all_value":false,"allow_multiple":false,"default_value":"250.0","display":{"name":"Apdex
    Tolerable Threshold"},"name":"tolerable_threshold","plugin":{"kind":"PrometheusLabelValuesVariable","spec":{"label_name":"le","matchers":["http_server_duration_milliseconds_bucket{app_env=~\"$app_env\",
    job=~\"$job\",  le !=\"+Inf\"}"]}},"refresh":"DashboardLoad"}}],"duration":"5m"},"spec_version":"1"}'
