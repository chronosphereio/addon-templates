api_version: v1/config
kind: Dashboard
spec:
  slug: gcp-memorystore-for-redis
  name: 'GCP Memorystore for Redis'
  collection_slug: gcp-collection
  dashboard_json: '{"kind":"Dashboard","spec":{"datasource":null,"duration":"30m","layouts":[{"kind":"Grid","spec":{"display":{"collapse":{"open":true},"title":"Overview"},"items":[{"content":{"$ref":"#/spec/panels/TotalNodesReporting"},"height":6,"width":6,"x":0,"y":0},{"content":{"$ref":"#/spec/panels/NodesReporting-5"},"height":6,"width":6,"x":18,"y":0},{"content":{"$ref":"#/spec/panels/NodesReporting"},"height":6,"width":6,"x":12,"y":0},{"content":{"$ref":"#/spec/panels/NodesReporting-3"},"height":6,"width":6,"x":6,"y":0}]}},{"kind":"Grid","spec":{"display":{"collapse":{"open":true},"title":"Clients"},"items":[{"content":{"$ref":"#/spec/panels/Blockedclients-11"},"height":8,"width":7,"x":0,"y":0},{"content":{"$ref":"#/spec/panels/Blockedclients"},"height":8,"width":17,"x":7,"y":0},{"content":{"$ref":"#/spec/panels/Blockedclients-12"},"height":8,"width":17,"x":7,"y":8},{"content":{"$ref":"#/spec/panels/Blockedclients-10"},"height":8,"width":7,"x":0,"y":8}]}},{"kind":"Grid","spec":{"display":{"collapse":{"open":true},"title":"Commands"},"items":[{"content":{"$ref":"#/spec/panels/Calls"},"height":8,"width":7,"x":0,"y":0},{"content":{"$ref":"#/spec/panels/Calls-13"},"height":8,"width":17,"x":7,"y":0},{"content":{"$ref":"#/spec/panels/14"},"height":10,"width":24,"x":0,"y":8},{"content":{"$ref":"#/spec/panels/CommandsTimePer-Call"},"height":10,"width":24,"x":0,"y":18}]}},{"kind":"Grid","spec":{"display":{"collapse":{"open":true},"title":"System"},"items":[{"content":{"$ref":"#/spec/panels/CPUUtilization"},"height":12,"width":12,"x":0,"y":0},{"content":{"$ref":"#/spec/panels/CPUUtilization-1"},"height":12,"width":12,"x":12,"y":0}]}},{"kind":"Grid","spec":{"display":{"collapse":{"open":true},"title":"Keyspace"},"items":[{"content":{"$ref":"#/spec/panels/EvictedandExpiredKeys-2"},"height":10,"width":24,"x":0,"y":0},{"content":{"$ref":"#/spec/panels/EvictedandExpiredKeys"},"height":11,"width":12,"x":0,"y":10},{"content":{"$ref":"#/spec/panels/EvictedandExpiredKeys-4"},"height":11,"width":12,"x":12,"y":10}]}},{"kind":"Grid","spec":{"display":{"collapse":{"open":true},"title":"Replication"},"items":[{"content":{"$ref":"#/spec/panels/Bytespendingreplication"},"height":10,"width":12,"x":0,"y":0},{"content":{"$ref":"#/spec/panels/Bytespendingreplication-5"},"height":10,"width":12,"x":12,"y":0}]}}],"panels":{"14":{"kind":"Panel","spec":{"display":{"description":"top 50","name":"Commands Time Per-Call"},"formulas":[],"links":[],"plugin":{"kind":"TimeSeriesChart","spec":{"legend":{"position":"Right","size":"Medium"},"visual":{"area_opacity":0,"colorPalette":"Consistent","display":"line","line_width":1},"y_axis":{"unit":{"kind":"Microseconds"}}}},"queries":[{"kind":"DataQuery","spec":{"plugin":{"kind":"PrometheusTimeSeriesQuery","spec":{"query":"sum by(cmd, project_id) (gcp_redis_instance_redis_googleapis_com_commands_usec_per_call{project_id=~\"$project\",region=~\"$region\",instance_id=~\"$instance\",role=~\"$role\"})","series_name":{"type":"Labels"}}}}}]}},"Blockedclients":{"kind":"Panel","spec":{"display":{"description":"","name":"Connected Clients"},"formulas":[],"links":[],"plugin":{"kind":"TimeSeriesChart","spec":{"legend":{"mode":"Table","position":"Right","size":"Medium","values":["LastNumber"]},"visual":{"area_opacity":0.25,"colorPalette":"Consistent","display":"line","line_width":1}}},"queries":[{"kind":"DataQuery","spec":{"plugin":{"kind":"PrometheusTimeSeriesQuery","spec":{"query":"sum by(node_id, role) (gcp_redis_instance_redis_googleapis_com_clients_blocked{project_id=~\"$project\",region=~\"$region\",instance_id=~\"$instance\",role=~\"$role\"})","series_name":{"name_pattern":"{{ node_id }} | {{ role }}","type":"Labels"}}}}}]}},"Blockedclients-10":{"kind":"Panel","spec":{"display":{"description":"","name":"Blocked clients"},"formulas":[],"links":[],"plugin":{"kind":"PieChart","spec":{"aggregation_percent":3,"label_format":["Percent"],"legend":{"mode":"List","position":"Right","size":"Small"},"unit":{"abbreviate":true,"kind":"Decimal"},"visual":{"color_palette":"Consistent","display":"Donut","show_series_name":true}}},"queries":[{"kind":"DataQuery","spec":{"plugin":{"kind":"PrometheusTimeSeriesQuery","spec":{"query":"sum by(node_id, role) (gcp_redis_instance_redis_googleapis_com_clients_blocked{project_id=~\"$project\",region=~\"$region\",instance_id=~\"$instance\",role=~\"$role\"})","series_name":{"name_pattern":"{{ node_id }} | {{ role }}","type":"Labels"}}}}}]}},"Blockedclients-11":{"kind":"Panel","spec":{"display":{"description":"","name":"Connected Clients"},"formulas":[],"links":[],"plugin":{"kind":"PieChart","spec":{"aggregation_percent":3,"label_format":["Percent"],"legend":{"mode":"List","position":"Right","size":"Small"},"unit":{"abbreviate":true,"kind":"Decimal"},"visual":{"color_palette":"Consistent","display":"Donut","show_series_name":true}}},"queries":[{"kind":"DataQuery","spec":{"plugin":{"kind":"PrometheusTimeSeriesQuery","spec":{"query":"sum by(node_id, role) (gcp_redis_instance_redis_googleapis_com_clients_connected{project_id=~\"$project\",region=~\"$region\",instance_id=~\"$instance\",role=~\"$role\"})","series_name":{"name_pattern":"{{ node_id }} | {{ role }}","type":"Labels"}}}}}]}},"Blockedclients-12":{"kind":"Panel","spec":{"display":{"description":"","name":"Blocked clients"},"formulas":[],"links":[],"plugin":{"kind":"TimeSeriesChart","spec":{"legend":{"mode":"Table","position":"Right","size":"Medium","values":["LastNumber"]},"visual":{"area_opacity":0.25,"colorPalette":"Consistent","display":"line","line_width":1}}},"queries":[{"kind":"DataQuery","spec":{"plugin":{"kind":"PrometheusTimeSeriesQuery","spec":{"query":"sum by(node_id, role) (gcp_redis_instance_redis_googleapis_com_clients_connected{project_id=~\"$project\",region=~\"$region\",instance_id=~\"$instance\",role=~\"$role\"})","series_name":{"name_pattern":"{{ node_id }} | {{ role }}","type":"Labels"}}}}}]}},"Bytespendingreplication":{"kind":"Panel","spec":{"display":{"description":"The largest number of bytes that have not been replicated across all replicas. This is the biggest difference between replication byte offset (master) and replication byte offset (replica) of all replicas. Sampled every 60 seconds. After sampling, data is not visible for up to 180 seconds.","name":"Bytes pending replication"},"formulas":[],"links":[],"plugin":{"kind":"TimeSeriesChart","spec":{"visual":{"area_opacity":0.1,"line_width":1}}},"queries":[{"kind":"DataQuery","spec":{"plugin":{"kind":"PrometheusTimeSeriesQuery","spec":{"query":"gcp_redis_instance_redis_googleapis_com_replication_offset_diff{project_id=~\"$project\",region=~\"$region\",instance_id=~\"$instance\",role=~\"$role\"}"}}}}]}},"Bytespendingreplication-5":{"kind":"Panel","spec":{"display":{"description":"The number of seconds that replica is lagging behind primary. Sampled every 60 seconds. After sampling, data is not visible for up to 180 seconds","name":"Seconds lagging"},"formulas":[],"links":[],"plugin":{"kind":"TimeSeriesChart","spec":{"visual":{"area_opacity":0.1,"line_width":1}}},"queries":[{"kind":"DataQuery","spec":{"plugin":{"kind":"PrometheusTimeSeriesQuery","spec":{"query":"gcp_redis_instance_redis_googleapis_com_replication_master_slaves_lag{project_id=~\"$project\",region=~\"$region\",instance_id=~\"$instance\",role=~\"$role\"}"}}}}]}},"CPUUtilization":{"kind":"Panel","spec":{"display":{"description":"CPU-seconds consumed by the Redis server, broken down by system/user space and parent/child relationship. Sampled every 60 seconds. After sampling, data is not visible for up to 180 seconds.","name":"CPU Utilization"},"formulas":[],"links":[],"plugin":{"kind":"TimeSeriesChart","spec":{"legend":{"mode":"Table","position":"Bottom","size":"Medium","values":["LastNumber","Mean","Max"]},"visual":{"area_opacity":0.1,"colorPalette":"Consistent","line_width":1}}},"queries":[{"kind":"DataQuery","spec":{"plugin":{"kind":"PrometheusTimeSeriesQuery","spec":{"query":"sum(sum_per_second(gcp_redis_instance_redis_googleapis_com_stats_cpu_utilization{project_id=~\"$project\",region=~\"$region\",instance_id=~\"$instance\",role=~\"$role\"}[$__rate_interval]offset 180s) \u003e 0 ) by (role, space)"}}}}]}},"CPUUtilization-1":{"kind":"Panel","spec":{"display":{"description":"Memory usage as a ratio of maximum system memory. Sampled every 60 seconds. After sampling, data is not visible for up to 180 seconds.","name":"Memory Usage Ratio"},"formulas":[],"links":[],"plugin":{"kind":"TimeSeriesChart","spec":{"visual":{"area_opacity":0,"colorPalette":"Consistent","display":"line","line_width":1},"y_axis":{"unit":{"kind":"PercentDecimal"}}}},"queries":[{"kind":"DataQuery","spec":{"alias":"","plugin":{"kind":"PrometheusTimeSeriesQuery","spec":{"query":"head_max(gcp_redis_instance_redis_googleapis_com_stats_memory_usage_ratio{project_id=~\"$project\",region=~\"$region\",instance_id=~\"$instance\",role=~\"$role\"} \u003e 0, 20)","series_name":{"name_pattern":"{{ role }} | {{ region }} | {{ instance_id }} | {{node_id}}","type":"Labels"}}}}}]}},"Calls":{"kind":"Panel","spec":{"display":{"description":"Total number of calls for this command in one minute. Sampled every 60 seconds. After sampling, data is not visible for up to 240 seconds.","name":"Calls"},"formulas":[],"links":[],"plugin":{"kind":"PieChart","spec":{"aggregation_percent":5,"label_format":["Percent"],"legend":{"mode":"Table","position":"Right","size":"Medium"},"unit":{"abbreviate":true,"kind":"Decimal"},"visual":{"color_palette":"Consistent","display":"Donut","show_series_name":true}}},"queries":[{"kind":"DataQuery","spec":{"plugin":{"kind":"PrometheusTimeSeriesQuery","spec":{"query":"sum by(cmd) (sum_over_time(gcp_redis_instance_redis_googleapis_com_commands_calls{project_id=~\"$project\",region=~\"$region\",instance_id=~\"$instance\",role=~\"$role\"}[$__interval] offset 240s))","queryType":"Range","reducer":"LastNumber","series_name":{"name_pattern":"{{ cmd }}","type":"Labels"}}}}}]}},"Calls-13":{"kind":"Panel","spec":{"display":{"description":"Total number of calls for this command in one minute. Sampled every 60 seconds. After sampling, data is not visible for up to 240 seconds.","name":"Calls"},"formulas":[],"links":[],"plugin":{"kind":"TimeSeriesChart","spec":{"legend":{"position":"Bottom"},"visual":{"area_opacity":0.3,"colorPalette":"Consistent","display":"bar","line_width":1,"stack":"All"}}},"queries":[{"kind":"DataQuery","spec":{"plugin":{"kind":"PrometheusTimeSeriesQuery","spec":{"query":"sum by(cmd) (sum_over_time(gcp_redis_instance_redis_googleapis_com_commands_calls{project_id=~\"$project\",region=~\"$region\",instance_id=~\"$instance\",role=~\"$role\"}[$__interval] offset 240s))","series_name":{"name_pattern":"{{ cmd }}","type":"Labels"}}}}}]}},"CommandsTimePer-Call":{"kind":"Panel","spec":{"display":{"description":"The amount of time in microseconds that this command took in the last second. Sampled every 60 seconds. After sampling, data is not visible for up to 240 seconds.","name":"Commands Time by Project"},"formulas":[],"links":[],"plugin":{"kind":"TimeSeriesChart","spec":{"legend":{"mode":"Table","position":"Right","size":"Medium","values":["LastNumber","Max","Mean"]},"visual":{"area_opacity":0.2,"display":"line","line_width":1},"y_axis":{"unit":{"kind":"Microseconds"}}}},"queries":[{"kind":"DataQuery","spec":{"plugin":{"kind":"PrometheusTimeSeriesQuery","spec":{"query":"sum by(project_id, cmd) (sum_per_second(gcp_redis_instance_redis_googleapis_com_commands_total_time{project_id=~\"$project\",region=~\"$region\",instance_id=~\"$instance\",role=~\"$role\"}[$__rate_interval] offset 240s))","series_name":{"type":"Labels"}}}}}]}},"EvictedandExpiredKeys":{"kind":"Panel","spec":{"display":{"description":"Number of evicted keys due to maxmemory limit. Total number of key expiration events. ","name":"Evicted and Expired Keys"},"formulas":[],"links":[],"plugin":{"kind":"PieChart","spec":{"aggregation_percent":3,"label_format":["Percent"],"legend":{"mode":"List","position":"Bottom","size":"Small"},"unit":{"abbreviate":true,"kind":"Decimal"},"visual":{"color_palette":"Consistent","show_series_name":true}}},"queries":[{"kind":"DataQuery","spec":{"alias":"Evicted","plugin":{"kind":"PrometheusTimeSeriesQuery","spec":{"query":"sum(sum_over_time(gcp_redis_instance_redis_googleapis_com_stats_evicted_keys{project_id=~\"$project\",region=~\"$region\",instance_id=~\"$instance\",role=~\"$role\"}[$__interval] offset 180s))","queryType":"Range","reducer":"Avg"}}}},{"kind":"DataQuery","spec":{"alias":"Expired","plugin":{"kind":"PrometheusTimeSeriesQuery","spec":{"min_step":"","query":"sum(sum_over_time(gcp_redis_instance_redis_googleapis_com_stats_expired_keys{project_id=~\"$project\",region=~\"$region\",instance_id=~\"$instance$\",role=~\"$role\"}[$__interval] offset 180s))","queryType":"Range","reducer":"Avg"}}}}]}},"EvictedandExpiredKeys-2":{"kind":"Panel","spec":{"display":{"description":" GAUGE, INT64, 1 redis_instance\tNumber of keys stored in this database. ","name":"Total Keys"},"formulas":[],"links":[],"plugin":{"kind":"TimeSeriesChart","spec":{"visual":{"area_opacity":0.3,"colorPalette":"Consistent","display":"line","line_width":1,"stack":"All"}}},"queries":[{"kind":"DataQuery","spec":{"alias":"Keys","disabled":false,"plugin":{"kind":"PrometheusTimeSeriesQuery","spec":{"query":"sum(gcp_redis_instance_redis_googleapis_com_keyspace_keys{project_id=~\"$project\",region=~\"$region\",instance_id=~\"$instance\",role=~\"$role\"})"}}}}]}},"EvictedandExpiredKeys-4":{"kind":"Panel","spec":{"display":{"description":"Number of evicted keys due to maxmemory limit. Total number of key expiration events. ","name":"Evicted and Expired Keys"},"formulas":[],"links":[],"plugin":{"kind":"TimeSeriesChart","spec":{"legend":{"position":"Right"},"visual":{"area_opacity":0,"colorPalette":"Consistent","display":"bar","line_width":1}}},"queries":[{"kind":"DataQuery","spec":{"alias":"Evicted","disabled":false,"plugin":{"kind":"PrometheusTimeSeriesQuery","spec":{"query":"sum(sum_over_time(gcp_redis_instance_redis_googleapis_com_stats_evicted_keys{project_id=~\"$project\",region=~\"$region\",instance_id=~\"$instance\",role=~\"$role\"}[$__interval] offset 180s))"}}}},{"kind":"DataQuery","spec":{"alias":"Expired","plugin":{"kind":"PrometheusTimeSeriesQuery","spec":{"min_step":"","query":"sum(sum_over_time(gcp_redis_instance_redis_googleapis_com_stats_expired_keys{project_id=~\"$project\",region=~\"$region\",instance_id=~\"$instance$\",role=~\"$role\"}[$__interval] offset 180s))"}}}}]}},"NodesReporting":{"kind":"Panel","spec":{"display":{"description":"Latest Number","name":"Clients Blocked"},"formulas":[],"links":[],"plugin":{"kind":"StatChart","spec":{"calculation":"LastNumber","thresholds":{"base":{"background_color":"#B85C00","color":"white"}},"unit":{"kind":"Decimal"}}},"queries":[{"kind":"DataQuery","spec":{"plugin":{"kind":"PrometheusTimeSeriesQuery","spec":{"query":"sum(gcp_redis_instance_redis_googleapis_com_clients_blocked{project_id=~\"$project\",region=~\"$region\",instance_id=~\"$instance\",role=~\"$role\"})","queryType":"Range","reducer":"LastNumber"}}}}]}},"NodesReporting-3":{"kind":"Panel","spec":{"display":{"description":"Latest Number - Number of client connections. Sampled every 60 seconds. After sampling, data is not visible for up to 180 seconds","name":"Client Connections"},"formulas":[],"links":[],"plugin":{"kind":"StatChart","spec":{"calculation":"LastNumber","thresholds":{"base":{"background_color":"#2A75CF","color":"white"}},"unit":{"kind":"Decimal"}}},"queries":[{"kind":"DataQuery","spec":{"plugin":{"kind":"PrometheusTimeSeriesQuery","spec":{"query":"sum(gcp_redis_instance_redis_googleapis_com_clients_connected{project_id=~\"$project\",region=~\"$region\",instance_id=~\"$instance\",role=~\"$role\"})","queryType":"Range","reducer":"LastNumber"}}}}]}},"NodesReporting-5":{"kind":"Panel","spec":{"display":{"description":"Count of Redis commands. Sampled every 60 seconds. After sampling, data is not visible for up to 240 seconds.","name":"Command Calls"},"formulas":[],"links":[],"plugin":{"kind":"StatChart","spec":{"calculation":"LastNumber","thresholds":{"base":{"background_color":"#2A75CF","color":"white"}},"unit":{"kind":"Decimal"}}},"queries":[{"kind":"DataQuery","spec":{"plugin":{"kind":"PrometheusTimeSeriesQuery","spec":{"query":"sum(sum_over_time(gcp_redis_instance_redis_googleapis_com_commands_calls{project_id=~\"$project\",region=~\"$region\",instance_id=~\"$instance\",role=~\"$role\"}[$__interval] offset 240s ))","queryType":"Range","reducer":"LastNumber"}}}}]}},"TotalNodesReporting":{"kind":"Panel","spec":{"display":{"description":"Current number of Nodes reporting","name":"Nodes Reporting"},"formulas":[],"links":[],"plugin":{"kind":"StatChart","spec":{"calculation":"LastNumber","thresholds":{"base":{"background_color":"#2A75CF","color":"white"}},"unit":{"kind":"Decimal"}}},"queries":[{"kind":"DataQuery","spec":{"plugin":{"kind":"PrometheusTimeSeriesQuery","spec":{"query":"count (sum by(node_id) (gcp_redis_instance_redis_googleapis_com_clients_blocked{project_id=~\"$project\",region=~\"$region\",instance_id=~\"$instance\",role=~\"$role\"}))","queryType":"Range","reducer":"LastNumber"}}}}]}}},"variables":[{"kind":"ListVariable","spec":{"allow_all_value":true,"allow_multiple":true,"custom_all_value":".*","default_value":"$__all","name":"project","plugin":{"kind":"PrometheusLabelValuesVariable","spec":{"label_name":"project_id","matchers":["gcp_redis_instance_redis_googleapis_com_commands_usec_per_call{}"]}},"refresh":"DashboardLoad"}},{"kind":"ListVariable","spec":{"allow_all_value":true,"allow_multiple":true,"custom_all_value":".*","default_value":"$__all","name":"region","plugin":{"kind":"PrometheusLabelValuesVariable","spec":{"label_name":"region","matchers":["gcp_redis_instance_redis_googleapis_com_commands_usec_per_call{}"]}},"refresh":"DashboardLoad"}},{"kind":"ListVariable","spec":{"allow_all_value":true,"allow_multiple":true,"custom_all_value":".*","default_value":"$__all","name":"instance","plugin":{"kind":"PrometheusLabelValuesVariable","spec":{"label_name":"instance_id","matchers":["gcp_redis_instance_redis_googleapis_com_commands_usec_per_call{}"]}}}},{"kind":"ListVariable","spec":{"allow_all_value":true,"allow_multiple":true,"custom_all_value":".*","default_value":"$__all","name":"role","plugin":{"kind":"PrometheusLabelValuesVariable","spec":{"label_name":"role","matchers":["gcp_redis_instance_redis_googleapis_com_commands_usec_per_call{}"]}}}}],"events":[]},"spec_version":"1"}'
